@model MunicipalityServiceApp.Models.ReportIssueModel
@{
    ViewData["Title"] = "Report Issues Page";
}

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="~/css/reportIssues.css" asp-append-version="true" />
</head>

<div class="text-center">
    <h1 class="display-4">Report Issues</h1>

    <!-- Added form wrapper with id="issuesForm" -->
    <form id="issuesForm" method="post" enctype="multipart/form-data">

        <div class="reportQuestions">
            <label asp-for="Location" class="control-label">Location:</label>
            <input asp-for="Location" type="text" class="form-control txtLocation" style="width:350px;" name="Location"
                placeholder="Enter your location" />

            <label asp-for="Category" class="control-label">Category:</label>
            <select asp-for="Category" class="form-control" name="Category" style="width:350px;">
                <option value="">Select Category</option>
                <option value="Sanitation">Sanitation</option>
                <option value="Roads">Roads</option>
                <option value="Utilities">Utilities</option>
            </select>

            <label asp-for="Description" class="control-label">Description:</label>
            <textarea asp-for="Description" class="form-control description-box" id="txtDescription"
                placeholder="Describe the issue" style="width:500px; height:150px;"></textarea>
            <span asp-validation-for="Description" class="text-danger"></span>

            <label asp-for="MediaAttachment" class="control-label">Upload document or image:</label>
            <input type="file" class="form-control-file" id="mediaAttachment" name="mediaAttachment"
                accept=".jpg,.jpeg,.png,.pdf" />

            <!-- Progress Bar -->
            <div class="progressBar mt-3">
                <div class="progress" style="height: 25px; background: #ddd;">
                    <div class="progress-bar" id="progressBar" role="progressbar"
                        style="width:@(ViewBag.Progress ?? 0)%;" aria-valuenow="@(ViewBag.Progress ?? 0)"
                        aria-valuemin="0" aria-valuemax="100">
                        @(ViewBag.Progress ?? 0)%
                    </div>
                </div>
            </div>

            <button type="submit" id="btnSubmit" class="btn btn-primary mt-3">Submit</button>
        </div>
    </form>
</div>

<!-- JS must go at bottom -->
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const form = document.getElementById("issuesForm");
        const inputs = document.querySelectorAll("#issuesForm input[required], #issuesForm select[required], #issuesForm textarea[required]");
        const progressBar = document.getElementById("progressBar");
        const submitBtn = document.getElementById("btnSubmit");

        function updateProgressBar() {
            let filled = 0;
            inputs.forEach(input => {
                if (input.type === "file") {
                    if (input.files.length > 0) filled++;
                } else if (input.value.trim() !== "") {
                    filled++;
                }
            });

            const percent = Math.round((filled / inputs.length) * 100);
            progressBar.style.width = percent + "%";
            progressBar.innerText = percent + "%";
            progressBar.setAttribute("aria-valuenow", percent);

            //enable submit button only when 100% filled
            if (percent === 100) {
                submitBtn.disabled = false;
            } else {
                submitBtn.disabled = true;
            }
        }

        inputs.forEach(input => {
            input.addEventListener("input", updateProgressBar);
            if (input.type === "file") {
                input.addEventListener("change", updateProgressBar);
            }
        });
        submitBtn.disabled = true;
    });
</script>
